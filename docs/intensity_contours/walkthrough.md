# Walkthrough - 震度等高線 & Twitter修正

## 実装内容

### 1. 震度予測の等高線風表示
#### [MODIFY] [js/map.js](file:///Users/saki/lab/anken/disaster-prevention-system/js/map.js)

**新機能: `calculateIntensityZones(magnitude)`**
地震のマグニチュードから距離減衰を考慮した震度分布を計算します。

**視覚化の特徴:**
- **同心円状の震度ゾーン**: 震源地から距離に応じて震度が減衰
- **色分け**: 
  - 震度7: ダークレッド (#8B0000)
  - 震度6強: 赤 (#D50000)
  - 震度6弱: オレンジレッド (#FF5722)
  - 震度5強/5弱: オレンジ/黄色
  - 震度4: ライトオレンジ
  - 震度3以下: 緑/青
- **破線表示**: 外側の予測ゾーンは破線で表示（不確実性を示す）
- **透明度**: 外側ほど透明度が高い

**マグニチュード別のゾーン設定:**
- M7以上: 最大5つの震度ゾーン（震度7〜5弱）
- M6台: 震度6強〜4
- M5台: 震度5強〜3
- M4台: 震度4〜2
- M4未満: 震度3〜2

### 2. Twitter埋め込み修正
#### [MODIFY] [index.html](file:///Users/saki/lab/anken/disaster-prevention-system/index.html)

**修正点:**
1. `data-lang="ja"` 属性を追加（日本語ツイート優先）
2. URLから `&f=live` パラメータを削除（互換性向上）
3. インラインスクリプトタグを追加（ローカル環境での読み込み向上）

**注意事項:**
- file:// プロトコルではTwitterウィジェットが動作しない場合があります
- ローカルサーバー（`python3 -m http.server`）で開くことを推奨

### 3. データ構造の改善
#### [MODIFY] [js/api.js](file:///Users/saki/lab/anken/disaster-prevention-system/js/api.js)

JMAデータのパース時に `mag` フィールドを明示的に保存し、震度計算で使用できるようにしました。

## 視覚効果

実際の地震データでは、以下のような表示になります：

- **震源地**: 白枠付きの色付きマーカー
- **予測震度ゾーン**: 複数の同心円が重なり、等高線のような視覚効果
- **クリック時**: 各円をクリックすると予測震度が表示される

## 確認方法

1. ブラウザをリロード
2. 地図上の地震マーカー周辺に、複数の色付き同心円が表示されることを確認
3. 円をクリックすると「予測震度: X」と表示される
4. SNSタブでTwitterタイムラインが表示されるか確認（ローカルサーバー推奨）
